<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    /* Add your CSS styles here */
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    form {
      margin-bottom: 20px;
    }
    #submissionSuccess {
      display: none;
      color: green;
    }
    #error {
      display: none;
      color: red;
    }
  </style>
</head>
<body>
  <h1>Referral Form</h1>
  <form id="referralForm">
    <label for="userName">Name:</label>
    <input type="text" id="userName" required><br><br>

    <label for="mobileNumber">Mobile Number:</label>
    <input type="tel" id="mobileNumber" required><br><br>

    <label for="userLanguage">Language:</label>
    <select id="userLanguage" required>
      <option value="English">English</option>
      <option value="Spanish">Spanish</option>
      <!-- Add other options as needed -->
    </select><br><br>

    <label for="resourceCount">Number of Resources:</label>
    <input type="number" id="resourceCount" min="1" required><br><br>

    <div id="referenceDetails">
      <h2>References</h2>
      <table id="referenceTable">
        <thead>
          <tr>
            <th>Name</th>
            <th>Phone</th>
            <th>Language</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><input type="text" required></td>
            <td><input type="tel" required></td>
            <td>
              <select required>
                <option value="English">English</option>
                <option value="Spanish">Spanish</option>
                <!-- Add other options as needed -->
              </select>
            </td>
          </tr>
          <!-- Add more rows as needed -->
        </tbody>
      </table>
      <button type="button" id="addReference">Add Another Reference</button>
    </div>
    <br>
    <button type="submit">Submit</button>
  </form>

  <div id="submissionSuccess">
    <p>Form submitted successfully.</p>
    <p>If you want to submit another form, please <span id="anotherResponse">click here</span>.</p>
  </div>

  <div id="error">
    <p>Error submitting the form. Please try again.</p>
  </div>

  <script>
    document.getElementById('referralForm').addEventListener('submit', function(e) {
      e.preventDefault();

      // Gather form data
      const formData = {
        userName: document.getElementById('userName').value.trim(),
        mobileNumber: document.getElementById('mobileNumber').value.trim(),
        userLanguage: document.getElementById('userLanguage').value,
        resourceCount: parseInt(document.getElementById('resourceCount').value),
        references: getReferences()
      };

      // Submit the form data
      fetch('https://script.google.com/macros/s/AKfycbx9gYclCQYsyd5YjeklF4iNVaCSZ1nPlTc-km6wictZaJMnMEkmPk6Vkfy3tI6fk1bvFg/exec', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(formData)
      })
      .then(response => response.text())
      .then(result => {
        document.getElementById('submissionSuccess').style.display = 'block';
        document.getElementById('referralForm').style.display = 'none';
        document.getElementById('error').style.display = 'none';
      })
      .catch(error => {
        console.error('Error submitting the form:', error);
        document.getElementById('error').style.display = 'block';
      });
    });

    function getReferences() {
      const references = [];
      const rows = document.getElementById('referenceTable').querySelectorAll('tbody tr');
      rows.forEach(row => {
        const refName = row.querySelector('td:nth-child(1) input').value.trim();
        const refPhone = row.querySelector('td:nth-child(2) input').value.trim();
        const refLang = row.querySelector('td:nth-child(3) select').value;
        references.push({ name: refName, phone: refPhone, language: refLang });
      });
      return references;
    }

    document.getElementById('anotherResponse').addEventListener('click', function() {
      document.getElementById('referralForm').style.display = 'block';
      document.getElementById('referralForm').reset();
      document.getElementById('referenceDetails').style.display = 'none';
      document.getElementById('submissionSuccess').style.display = 'none';
      document.getElementById('error').style.display = 'none';
    });

    document.getElementById('addReference').addEventListener('click', function() {
      const tableBody = document.getElementById('referenceTable').querySelector('tbody');
      const newRow = document.createElement('tr');
      newRow.innerHTML = `
        <td><input type="text" required></td>
        <td><input type="tel" required></td>
        <td>
          <select required>
            <option value="English">English</option>
            <option value="Spanish">Spanish</option>
            <!-- Add other options as needed -->
          </select>
        </td>
      `;
      tableBody.appendChild(newRow);
    });
  </script>
</body>
</html>
